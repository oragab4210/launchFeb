{"ast":null,"code":"import onCacheWrite from './onCacheWrite';\nimport onAppBackground from './onAppBackground';\n\nvar Trigger = function () {\n  function Trigger(_a, options) {\n    var _this = this;\n\n    var log = _a.log,\n        persistor = _a.persistor;\n\n    this.fire = function () {\n      if (!_this.debounce) {\n        _this.persist();\n\n        return;\n      }\n\n      if (_this.timeout != null) {\n        clearTimeout(_this.timeout);\n      }\n\n      _this.timeout = setTimeout(_this.persist, _this.debounce);\n    };\n\n    this.persist = function () {\n      if (_this.paused) {\n        return;\n      }\n\n      _this.persistor.persist();\n    };\n\n    var defaultDebounce = Trigger.defaultDebounce;\n    var cache = options.cache,\n        debounce = options.debounce,\n        _b = options.trigger,\n        trigger = _b === void 0 ? 'write' : _b;\n\n    if (!trigger) {\n      return;\n    }\n\n    this.debounce = debounce != null ? debounce : defaultDebounce;\n    this.persistor = persistor;\n    this.paused = false;\n\n    switch (trigger) {\n      case 'write':\n        this.uninstall = onCacheWrite({\n          cache: cache\n        })(this.fire);\n        break;\n\n      case 'background':\n        if (debounce) {\n          log.warn('Debounce is not recommended with `background` trigger');\n        }\n\n        this.debounce = debounce;\n        this.uninstall = onAppBackground({\n          cache: cache,\n          log: log\n        })(this.fire);\n        break;\n\n      default:\n        if (typeof trigger === 'function') {\n          this.uninstall = trigger(this.fire);\n        } else {\n          throw Error(\"Unrecognized trigger option: \" + trigger);\n        }\n\n    }\n  }\n\n  Trigger.prototype.pause = function () {\n    this.paused = true;\n  };\n\n  Trigger.prototype.resume = function () {\n    this.paused = false;\n  };\n\n  Trigger.prototype.remove = function () {\n    if (this.uninstall) {\n      this.uninstall();\n      this.uninstall = null;\n      this.paused = true;\n    }\n  };\n\n  Trigger.defaultDebounce = 1000;\n  return Trigger;\n}();\n\nexport default Trigger;","map":{"version":3,"sources":["../src/Trigger.ts"],"names":[],"mappings":"AAAA,OAAO,YAAP,MAAyB,gBAAzB;AACA,OAAO,eAAP,MAA4B,mBAA5B;;AAWA,IAAA,OAAA,GAAA,YAAA;AASE,WAAA,OAAA,CACE,EADF,EAEE,OAFF,EAEkC;AAFlC,QAAA,KAAA,GAAA,IAAA;;QACI,GAAG,GAAA,EAAA,CAAA,G;QAAE,SAAS,GAAA,EAAA,CAAA,S;;AAoDlB,SAAA,IAAA,GAAO,YAAA;AACL,UAAI,CAAC,KAAI,CAAC,QAAV,EAAoB;AAClB,QAAA,KAAI,CAAC,OAAL;;AACA;AACD;;AAED,UAAI,KAAI,CAAC,OAAL,IAAgB,IAApB,EAA0B;AACxB,QAAA,YAAY,CAAC,KAAI,CAAC,OAAN,CAAZ;AACD;;AAED,MAAA,KAAI,CAAC,OAAL,GAAe,UAAU,CAAC,KAAI,CAAC,OAAN,EAAe,KAAI,CAAC,QAApB,CAAzB;AACD,KAXD;;AAaA,SAAA,OAAA,GAAU,YAAA;AACR,UAAI,KAAI,CAAC,MAAT,EAAiB;AACf;AACD;;AAED,MAAA,KAAI,CAAC,SAAL,CAAe,OAAf;AACD,KAND;;AA9DU,QAAA,eAAe,GAAK,OAAO,CAAZ,eAAf;AACA,QAAA,KAAK,GAAkC,OAAO,CAAzC,KAAL;AAAA,QAAO,QAAQ,GAAwB,OAAO,CAA/B,QAAf;AAAA,QAAiB,EAAA,GAAsB,OAAO,CAAZ,OAAlC;AAAA,QAAiB,OAAO,GAAA,EAAA,KAAA,KAAA,CAAA,GAAG,OAAH,GAAU,EAAlC;;AAER,QAAI,CAAC,OAAL,EAAc;AACZ;AACD;;AAED,SAAK,QAAL,GAAgB,QAAQ,IAAI,IAAZ,GAAmB,QAAnB,GAA8B,eAA9C;AACA,SAAK,SAAL,GAAiB,SAAjB;AACA,SAAK,MAAL,GAAc,KAAd;;AAEA,YAAQ,OAAR;AACE,WAAK,OAAL;AACE,aAAK,SAAL,GAAiB,YAAY,CAAC;AAAE,UAAA,KAAK,EAAA;AAAP,SAAD,CAAZ,CAAwB,KAAK,IAA7B,CAAjB;AACA;;AAEF,WAAK,YAAL;AACE,YAAI,QAAJ,EAAc;AACZ,UAAA,GAAG,CAAC,IAAJ,CAAS,uDAAT;AACD;;AACD,aAAK,QAAL,GAAgB,QAAhB;AACA,aAAK,SAAL,GAAiB,eAAe,CAAC;AAAE,UAAA,KAAK,EAAA,KAAP;AAAS,UAAA,GAAG,EAAA;AAAZ,SAAD,CAAf,CAAgC,KAAK,IAArC,CAAjB;AACA;;AAEF;AACE,YAAI,OAAO,OAAP,KAAmB,UAAvB,EAAmC;AACjC,eAAK,SAAL,GAAiB,OAAO,CAAC,KAAK,IAAN,CAAxB;AACD,SAFD,MAEO;AACL,gBAAM,KAAK,CAAC,kCAAgC,OAAjC,CAAX;AACD;;AAlBL;AAoBD;;AAED,EAAA,OAAA,CAAA,SAAA,CAAA,KAAA,GAAA,YAAA;AACE,SAAK,MAAL,GAAc,IAAd;AACD,GAFD;;AAIA,EAAA,OAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACE,SAAK,MAAL,GAAc,KAAd;AACD,GAFD;;AAIA,EAAA,OAAA,CAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACE,QAAI,KAAK,SAAT,EAAoB;AAClB,WAAK,SAAL;AACA,WAAK,SAAL,GAAiB,IAAjB;AACA,WAAK,MAAL,GAAc,IAAd;AACD;AACF,GAND;;AA/CO,EAAA,OAAA,CAAA,eAAA,GAAkB,IAAlB;AA2ET,SAAA,OAAA;AAAC,CAlFD,EAAA;;eAAqB,O","sourceRoot":"","sourcesContent":["import onCacheWrite from './onCacheWrite';\nimport onAppBackground from './onAppBackground';\nvar Trigger = (function () {\n    function Trigger(_a, options) {\n        var _this = this;\n        var log = _a.log, persistor = _a.persistor;\n        this.fire = function () {\n            if (!_this.debounce) {\n                _this.persist();\n                return;\n            }\n            if (_this.timeout != null) {\n                clearTimeout(_this.timeout);\n            }\n            _this.timeout = setTimeout(_this.persist, _this.debounce);\n        };\n        this.persist = function () {\n            if (_this.paused) {\n                return;\n            }\n            _this.persistor.persist();\n        };\n        var defaultDebounce = Trigger.defaultDebounce;\n        var cache = options.cache, debounce = options.debounce, _b = options.trigger, trigger = _b === void 0 ? 'write' : _b;\n        if (!trigger) {\n            return;\n        }\n        this.debounce = debounce != null ? debounce : defaultDebounce;\n        this.persistor = persistor;\n        this.paused = false;\n        switch (trigger) {\n            case 'write':\n                this.uninstall = onCacheWrite({ cache: cache })(this.fire);\n                break;\n            case 'background':\n                if (debounce) {\n                    log.warn('Debounce is not recommended with `background` trigger');\n                }\n                this.debounce = debounce;\n                this.uninstall = onAppBackground({ cache: cache, log: log })(this.fire);\n                break;\n            default:\n                if (typeof trigger === 'function') {\n                    this.uninstall = trigger(this.fire);\n                }\n                else {\n                    throw Error(\"Unrecognized trigger option: \" + trigger);\n                }\n        }\n    }\n    Trigger.prototype.pause = function () {\n        this.paused = true;\n    };\n    Trigger.prototype.resume = function () {\n        this.paused = false;\n    };\n    Trigger.prototype.remove = function () {\n        if (this.uninstall) {\n            this.uninstall();\n            this.uninstall = null;\n            this.paused = true;\n        }\n    };\n    Trigger.defaultDebounce = 1000;\n    return Trigger;\n}());\nexport default Trigger;\n//# sourceMappingURL=Trigger.js.map"]},"metadata":{},"sourceType":"module"}