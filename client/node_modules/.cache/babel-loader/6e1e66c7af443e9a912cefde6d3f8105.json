{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { useMutation, useQuery, useLazyQuery } from \"@apollo/client\";\nimport addConversationMutation from \"../../GQL/mutations/addConversation\";\nimport editMessageMutation from \"../../GQL/mutations/editMessage\";\nimport getMessagesQuery from \"../../GQL/queries/getMessages\";\nimport useChatRoom from \"./useChatRoom\";\nimport { useAppSelector, useAppDispatch } from \"../../redux/hooks\";\nimport { setPreviousMessages } from \"../../redux/features/previousMessagesSlice\";\n\nconst useMessages = () => {\n  _s();\n\n  const currentUser = useAppSelector(state => state.currentUser);\n  const room = useAppSelector(state => state.currentRoom.value); // let {\n  //   loading: loadingMessages,\n  //   error: errorMessages,\n  //   data: dataMessages,\n  //   refetch: refetchMessages,\n  // } = useQuery(getMessagesQuery);\n  // useEffect(() => {\n  //   console.log(errorMessages);\n  // }, [errorMessages]);\n\n  const [messageList, setMessageList] = useState([]);\n  const [selectedFriend, setSelectedFriend] = useState(null);\n  const [addConversation] = useMutation(addConversationMutation);\n  const [editMessage] = useMutation(editMessageMutation);\n  const dispatch = useAppDispatch();\n  let [getCurrentFriendMessages, {\n    loading: messagesLoading,\n    error: messagesError,\n    data: messagesData,\n    refetch: messageRefetch\n  }] = useLazyQuery(getMessagesQuery, {\n    variables: {\n      convoId: room\n    }\n  });\n  /* -------------------------------------------------------------------------- */\n\n  useEffect(() => {\n    if (!messagesError && messagesData) {\n      dispatch(setPreviousMessages([]));\n\n      if (messagesData.messages[0] !== undefined) {\n        console.log(messagesData.messages);\n        const alteredMessageList = [];\n        messagesData.messages[0].messages.map(msg => {\n          const newMessage = {\n            body: \"\",\n            isOwner: false\n          };\n\n          if (msg.senderId === currentUser.id) {\n            newMessage.isOwner = true;\n          }\n\n          newMessage.body = msg.body;\n          alteredMessageList.push(newMessage);\n          return null;\n        });\n        setMessageList(alteredMessageList);\n        dispatch(setPreviousMessages(alteredMessageList));\n      }\n    } else {\n      return null;\n    }\n  }, [messagesData, messagesLoading, currentUser]);\n  /* -------------------------------------------------------------------------- */\n\n  const addMessage = (convoId, body) => {\n    editMessage({\n      variables: {\n        convoId: convoId,\n        addMessage: {\n          senderId: currentUser.id,\n          body: body\n        }\n      },\n      refetchQueries: [{\n        getMessagesQuery: getMessagesQuery\n      }],\n      awaitRefetchQueries: true\n    }).then(res => messageRefetch()).catch(err => {\n      var _err$graphQLErrors;\n\n      const errors = (_err$graphQLErrors = err.graphQLErrors) === null || _err$graphQLErrors === void 0 ? void 0 : _err$graphQLErrors.map(error => error.message);\n      console.log(errors);\n    }).then(res => setMessageList());\n  };\n  /* -------------------------------------------------------------------------- */\n\n\n  const alteredChatData = async () => {\n    if (messageList.length > 0) {\n      const newMessageList = [];\n      messageList.map(msg => {\n        const newMessage = {\n          body: \"\",\n          isOwner: false\n        };\n\n        if (msg.senderId === currentUser.id) {\n          newMessage.isOwner = true;\n        }\n\n        newMessage.body = msg.body;\n        return newMessageList.push(newMessage);\n      });\n      console.log(newMessageList);\n      return newMessageList;\n    }\n  };\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n\n\n  return {\n    messageList,\n    addMessage,\n    currentUser,\n    getCurrentFriendMessages,\n    selectedFriend,\n    setSelectedFriend,\n    setMessageList\n  }; //   }\n};\n\n_s(useMessages, \"V2/4phnjIBDXyQGf+jLddiGVhiE=\", false, function () {\n  return [useAppSelector, useAppSelector, useMutation, useMutation, useAppDispatch, useLazyQuery];\n});\n\nexport default useMessages;","map":{"version":3,"sources":["/Users/omarragab/Documents/Job/ResumeProject1/client/src/components/CHAT/useMessages.js"],"names":["React","useState","useEffect","useMutation","useQuery","useLazyQuery","addConversationMutation","editMessageMutation","getMessagesQuery","useChatRoom","useAppSelector","useAppDispatch","setPreviousMessages","useMessages","currentUser","state","room","currentRoom","value","messageList","setMessageList","selectedFriend","setSelectedFriend","addConversation","editMessage","dispatch","getCurrentFriendMessages","loading","messagesLoading","error","messagesError","data","messagesData","refetch","messageRefetch","variables","convoId","messages","undefined","console","log","alteredMessageList","map","msg","newMessage","body","isOwner","senderId","id","push","addMessage","refetchQueries","awaitRefetchQueries","then","res","catch","err","errors","graphQLErrors","message","alteredChatData","length","newMessageList"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useMutation, useQuery, useLazyQuery } from \"@apollo/client\";\n\nimport addConversationMutation from \"../../GQL/mutations/addConversation\";\nimport editMessageMutation from \"../../GQL/mutations/editMessage\";\nimport getMessagesQuery from \"../../GQL/queries/getMessages\";\nimport useChatRoom from \"./useChatRoom\";\nimport { useAppSelector, useAppDispatch } from \"../../redux/hooks\";\nimport { setPreviousMessages } from \"../../redux/features/previousMessagesSlice\";\n\nconst useMessages = () => {\n  const currentUser = useAppSelector((state) => state.currentUser);\n  const room = useAppSelector((state) => state.currentRoom.value);\n  // let {\n  //   loading: loadingMessages,\n  //   error: errorMessages,\n  //   data: dataMessages,\n  //   refetch: refetchMessages,\n  // } = useQuery(getMessagesQuery);\n  // useEffect(() => {\n  //   console.log(errorMessages);\n  // }, [errorMessages]);\n\n  const [messageList, setMessageList] = useState([]);\n  const [selectedFriend, setSelectedFriend] = useState(null);\n\n  const [addConversation] = useMutation(addConversationMutation);\n  const [editMessage] = useMutation(editMessageMutation);\n  const dispatch = useAppDispatch();\n\n  let [\n    getCurrentFriendMessages,\n    {\n      loading: messagesLoading,\n      error: messagesError,\n      data: messagesData,\n      refetch: messageRefetch,\n    },\n  ] = useLazyQuery(getMessagesQuery, {\n    variables: { convoId: room },\n  });\n\n  /* -------------------------------------------------------------------------- */\n\n  useEffect(() => {\n    if (!messagesError && messagesData) {\n      dispatch(setPreviousMessages([]));\n      if (messagesData.messages[0] !== undefined) {\n        console.log(messagesData.messages);\n        const alteredMessageList = [];\n\n        messagesData.messages[0].messages.map((msg) => {\n          const newMessage = { body: \"\", isOwner: false };\n          if (msg.senderId === currentUser.id) {\n            newMessage.isOwner = true;\n          }\n          newMessage.body = msg.body;\n\n          alteredMessageList.push(newMessage);\n          return null;\n        });\n\n        setMessageList(alteredMessageList);\n\n        dispatch(setPreviousMessages(alteredMessageList));\n      }\n    } else {\n      return null;\n    }\n  }, [messagesData, messagesLoading, currentUser]);\n\n  /* -------------------------------------------------------------------------- */\n  const addMessage = (convoId, body) => {\n    editMessage({\n      variables: {\n        convoId: convoId,\n        addMessage: { senderId: currentUser.id, body: body },\n      },\n      refetchQueries: [\n        {\n          getMessagesQuery: getMessagesQuery,\n        },\n      ],\n      awaitRefetchQueries: true,\n    })\n      .then((res) => messageRefetch())\n      .catch((err) => {\n        const errors = err.graphQLErrors?.map((error) => error.message);\n        console.log(errors);\n      })\n      .then((res) => setMessageList());\n  };\n  /* -------------------------------------------------------------------------- */\n  const alteredChatData = async () => {\n    if (messageList.length > 0) {\n      const newMessageList = [];\n      messageList.map((msg) => {\n        const newMessage = { body: \"\", isOwner: false };\n        if (msg.senderId === currentUser.id) {\n          newMessage.isOwner = true;\n        }\n        newMessage.body = msg.body;\n\n        return newMessageList.push(newMessage);\n      });\n      console.log(newMessageList);\n      return newMessageList;\n    }\n  };\n\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n\n  return {\n    messageList,\n    addMessage,\n    currentUser,\n    getCurrentFriendMessages,\n    selectedFriend,\n    setSelectedFriend,\n    setMessageList,\n  };\n  //   }\n};\n\nexport default useMessages;\n"]},"metadata":{},"sourceType":"module"}