{"ast":null,"code":"import _slicedToArray from\"/Users/omarragab/Documents/Job/ResumeProject1/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import styles from\"./EditDeletePost.module.css\";import React,{useState,useEffect,useRef}from\"react\";import{Modal}from\"./modal/modal\";import{useAppSelector,useAppDispatch}from\"../../../../redux/hooks\";import X_SVG from\"./x.svg\";import{useMutation,useQuery}from\"@apollo/client\";import currentUserQuery from\"../../../../GQL/queries/CurrentUser\";import editPostMutation from\"../../../../GQL/mutations/editPost\";import deletePostMutation from\"../../../../GQL/mutations/deletePost\";import editUserMutation from\"../../../../GQL/mutations/editUser\";import LoadingSpinner from\"../../../LoadingSpinner/LoadingSpinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditDeletePost=function EditDeletePost(_ref){var postId=_ref.postId,postContent=_ref.postContent;var _useMutation=useMutation(editPostMutation),_useMutation2=_slicedToArray(_useMutation,1),editPost=_useMutation2[0];var _useMutation3=useMutation(deletePostMutation),_useMutation4=_slicedToArray(_useMutation3,1),deletePost=_useMutation4[0];var _useMutation5=useMutation(editUserMutation),_useMutation6=_slicedToArray(_useMutation5,1),editUser=_useMutation6[0];var _useQuery=useQuery(currentUserQuery),refetch=_useQuery.refetch;var currentUser=useAppSelector(function(state){return state.currentUser;});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(postContent),_useState4=_slicedToArray(_useState3,2),postText=_useState4[0],setPostText=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];useEffect(function(){setPostText(postContent);},[postContent]);var editPostOnClick=function editPostOnClick(){setLoading(true);editPost({variables:{id:postId,post:postText},refetchQueries:[{query:currentUserQuery}],awaitRefetchQueries:true})// .then((res) => refetch())\n.then(function(res){return[setShowModal(false),setLoading(false)];}).catch(function(err){var _err$graphQLErrors;var errors=(_err$graphQLErrors=err.graphQLErrors)===null||_err$graphQLErrors===void 0?void 0:_err$graphQLErrors.map(function(error){return error.message;});console.log(errors);});};var deletePostOnClick=function deletePostOnClick(e){setLoading(true);console.log(\"start\");/* ----------------------------- delete Post ----------------------------- */deletePost({variables:{id:postId},refetchQueries:[{query:currentUserQuery}],awaitRefetchQueries:true})/* -----------------------------Delete post from User--------------------------------------------- */.then(function(res){return editUser({variables:{id:currentUser.id,deletePost:postId},refetchQueries:[{query:currentUserQuery}],awaitRefetchQueries:true}).then([setShowModal(false),setLoading(false)]).catch(function(err){var _err$graphQLErrors2;var errors=(_err$graphQLErrors2=err.graphQLErrors)===null||_err$graphQLErrors2===void 0?void 0:_err$graphQLErrors2.map(function(error){return error.message;});console.log(errors);});}).catch(function(err){var _err$graphQLErrors3;var errors=(_err$graphQLErrors3=err.graphQLErrors)===null||_err$graphQLErrors3===void 0?void 0:_err$graphQLErrors3.map(function(error){return error.message;});console.log(errors);});};if(!showModal)return/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setShowModal(true);},children:\"...\"});return/*#__PURE__*/_jsx(Modal,{showModal:showModal,setShowModal:setShowModal,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.container// ref={modal}\n,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.createPostContainer,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.titleContainer,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Edit Post\"}),/*#__PURE__*/_jsx(\"img\",{className:styles.x_svg,src:X_SVG,alt:\"exit\",onClick:function onClick(){return setShowModal(!showModal);}})]})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.contentContainer,children:[loading?/*#__PURE__*/_jsx(\"div\",{className:styles.LoadingSpinner,children:/*#__PURE__*/_jsx(LoadingSpinner,{})}):null,/*#__PURE__*/_jsx(\"div\",{className:styles.inputContainer,children:/*#__PURE__*/_jsx(\"textarea\",{className:styles.input,value:postText,onChange:function onChange(e){return setPostText(e.target.value);},placeholder:\"What's on your mind, \".concat(currentUser.name,\"?\")// maxlength=\"1\"\n})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.postBtnContainer,children:[/*#__PURE__*/_jsx(\"button\",{className:\"\".concat(styles.editBtn,\" \").concat(styles.btn),onClick:function onClick(){return editPostOnClick();},children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"\".concat(styles.deleteBtn,\" \").concat(styles.btn),onClick:function onClick(e){return deletePostOnClick();},children:\"Delete\"})]})]})]})});};export default EditDeletePost;","map":{"version":3,"sources":["/Users/omarragab/Documents/Job/ResumeProject1/client/src/components/Home/EverythingPosts/EditDeletePost/EditDeletePost.js"],"names":["styles","React","useState","useEffect","useRef","Modal","useAppSelector","useAppDispatch","useMutation","useQuery","currentUserQuery","editPostMutation","deletePostMutation","editUserMutation","LoadingSpinner","EditDeletePost","postId","postContent","editPost","deletePost","editUser","refetch","currentUser","state","showModal","setShowModal","postText","setPostText","loading","setLoading","editPostOnClick","variables","id","post","refetchQueries","query","awaitRefetchQueries","then","res","catch","err","errors","graphQLErrors","map","error","message","console","log","deletePostOnClick","e","container","createPostContainer","titleContainer","x_svg","X_SVG","contentContainer","inputContainer","input","target","value","name","postBtnContainer","editBtn","btn","deleteBtn"],"mappings":"2KAAA,MAAOA,CAAAA,MAAP,KAAmB,6BAAnB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,MAArC,KAAmD,OAAnD,CACA,OAASC,KAAT,KAAsB,eAAtB,CACA,OAASC,cAAT,CAAyBC,cAAzB,KAA+C,yBAA/C,C,2BAEA,OAASC,WAAT,CAAsBC,QAAtB,KAAsC,gBAAtC,CACA,MAAOC,CAAAA,gBAAP,KAA6B,qCAA7B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oCAA7B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,sCAA/B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oCAA7B,CACA,MAAOC,CAAAA,cAAP,KAA2B,wCAA3B,C,wFAEA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,MAA6B,IAA1BC,CAAAA,MAA0B,MAA1BA,MAA0B,CAAlBC,WAAkB,MAAlBA,WAAkB,CAClD,iBAAmBT,WAAW,CAACG,gBAAD,CAA9B,8CAAOO,QAAP,kBACA,kBAAqBV,WAAW,CAACI,kBAAD,CAAhC,+CAAOO,UAAP,kBACA,kBAAmBX,WAAW,CAACK,gBAAD,CAA9B,+CAAOO,QAAP,kBACA,cAAoBX,QAAQ,CAACC,gBAAD,CAA5B,CAAQW,OAAR,WAAQA,OAAR,CACA,GAAMC,CAAAA,WAAW,CAAGhB,cAAc,CAAC,SAACiB,KAAD,QAAWA,CAAAA,KAAK,CAACD,WAAjB,EAAD,CAAlC,CACA,cAAkCpB,QAAQ,CAAC,KAAD,CAA1C,wCAAOsB,SAAP,eAAkBC,YAAlB,eACA,eAAgCvB,QAAQ,CAACe,WAAD,CAAxC,yCAAOS,QAAP,eAAiBC,WAAjB,eACA,eAA8BzB,QAAQ,CAAC,KAAD,CAAtC,yCAAO0B,OAAP,eAAgBC,UAAhB,eACA1B,SAAS,CAAC,UAAM,CACdwB,WAAW,CAACV,WAAD,CAAX,CACD,CAFQ,CAEN,CAACA,WAAD,CAFM,CAAT,CAIA,GAAMa,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC5BD,UAAU,CAAC,IAAD,CAAV,CACAX,QAAQ,CAAC,CACPa,SAAS,CAAE,CACTC,EAAE,CAAEhB,MADK,CAETiB,IAAI,CAAEP,QAFG,CADJ,CAKPQ,cAAc,CAAE,CAAC,CAAEC,KAAK,CAAEzB,gBAAT,CAAD,CALT,CAMP0B,mBAAmB,CAAE,IANd,CAAD,CAQN;AARF,CASGC,IATH,CASQ,SAACC,GAAD,QAAS,CAACb,YAAY,CAAC,KAAD,CAAb,CAAsBI,UAAU,CAAC,KAAD,CAAhC,CAAT,EATR,EAUGU,KAVH,CAUS,SAACC,GAAD,CAAS,wBACd,GAAMC,CAAAA,MAAM,qBAAGD,GAAG,CAACE,aAAP,6CAAG,mBAAmBC,GAAnB,CAAuB,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACC,OAAjB,EAAvB,CAAf,CACAC,OAAO,CAACC,GAAR,CAAYN,MAAZ,EACD,CAbH,EAcD,CAhBD,CAiBA,GAAMO,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,CAAD,CAAO,CAC/BpB,UAAU,CAAC,IAAD,CAAV,CACAiB,OAAO,CAACC,GAAR,CAAY,OAAZ,EACA,6EACA5B,UAAU,CAAC,CACTY,SAAS,CAAE,CACTC,EAAE,CAAEhB,MADK,CADF,CAITkB,cAAc,CAAE,CAAC,CAAEC,KAAK,CAAEzB,gBAAT,CAAD,CAJP,CAKT0B,mBAAmB,CAAE,IALZ,CAAD,CAOR,qGAPF,CAQGC,IARH,CAQQ,SAACC,GAAD,QACJlB,CAAAA,QAAQ,CAAC,CACPW,SAAS,CAAE,CACTC,EAAE,CAAEV,WAAW,CAACU,EADP,CAETb,UAAU,CAAEH,MAFH,CADJ,CAKPkB,cAAc,CAAE,CAAC,CAAEC,KAAK,CAAEzB,gBAAT,CAAD,CALT,CAMP0B,mBAAmB,CAAE,IANd,CAAD,CAAR,CAQGC,IARH,CAQQ,CAACZ,YAAY,CAAC,KAAD,CAAb,CAAsBI,UAAU,CAAC,KAAD,CAAhC,CARR,EASGU,KATH,CASS,SAACC,GAAD,CAAS,yBACd,GAAMC,CAAAA,MAAM,sBAAGD,GAAG,CAACE,aAAP,8CAAG,oBAAmBC,GAAnB,CAAuB,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACC,OAAjB,EAAvB,CAAf,CACAC,OAAO,CAACC,GAAR,CAAYN,MAAZ,EACD,CAZH,CADI,EARR,EAuBGF,KAvBH,CAuBS,SAACC,GAAD,CAAS,yBACd,GAAMC,CAAAA,MAAM,sBAAGD,GAAG,CAACE,aAAP,8CAAG,oBAAmBC,GAAnB,CAAuB,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACC,OAAjB,EAAvB,CAAf,CACAC,OAAO,CAACC,GAAR,CAAYN,MAAZ,EACD,CA1BH,EA2BD,CA/BD,CAiCA,GAAI,CAACjB,SAAL,CAAgB,mBAAO,YAAK,OAAO,CAAE,yBAAMC,CAAAA,YAAY,CAAC,IAAD,CAAlB,EAAd,iBAAP,CAEhB,mBACE,KAAC,KAAD,EAAO,SAAS,CAAED,SAAlB,CAA6B,YAAY,CAAEC,YAA3C,uBACE,aACE,SAAS,CAAEzB,MAAM,CAACkD,SAClB;AAFF,wBAIE,YAAK,SAAS,CAAElD,MAAM,CAACmD,mBAAvB,uBACE,aAAK,SAAS,CAAEnD,MAAM,CAACoD,cAAvB,wBACE,iCADF,cAEE,YACE,SAAS,CAAEpD,MAAM,CAACqD,KADpB,CAEE,GAAG,CAAEC,KAFP,CAGE,GAAG,CAAC,MAHN,CAIE,OAAO,CAAE,yBAAM7B,CAAAA,YAAY,CAAC,CAACD,SAAF,CAAlB,EAJX,EAFF,GADF,EAJF,cAgBE,aAAK,SAAS,CAAExB,MAAM,CAACuD,gBAAvB,WACG3B,OAAO,cACN,YAAK,SAAS,CAAE5B,MAAM,CAACc,cAAvB,uBACE,KAAC,cAAD,IADF,EADM,CAIJ,IALN,cAME,YAAK,SAAS,CAAEd,MAAM,CAACwD,cAAvB,uBACE,iBACE,SAAS,CAAExD,MAAM,CAACyD,KADpB,CAEE,KAAK,CAAE/B,QAFT,CAGE,QAAQ,CAAE,kBAACuB,CAAD,QAAOtB,CAAAA,WAAW,CAACsB,CAAC,CAACS,MAAF,CAASC,KAAV,CAAlB,EAHZ,CAIE,WAAW,gCAA0BrC,WAAW,CAACsC,IAAtC,KACX;AALF,EADF,EANF,cAeE,aAAK,SAAS,CAAE5D,MAAM,CAAC6D,gBAAvB,wBACE,eACE,SAAS,WAAK7D,MAAM,CAAC8D,OAAZ,aAAuB9D,MAAM,CAAC+D,GAA9B,CADX,CAEE,OAAO,CAAE,yBAAMjC,CAAAA,eAAe,EAArB,EAFX,kBADF,cAOE,eACE,SAAS,WAAK9B,MAAM,CAACgE,SAAZ,aAAyBhE,MAAM,CAAC+D,GAAhC,CADX,CAEE,OAAO,CAAE,iBAACd,CAAD,QAAOD,CAAAA,iBAAiB,EAAxB,EAFX,oBAPF,GAfF,GAhBF,GADF,EADF,CAmDD,CApHD,CAsHA,cAAejC,CAAAA,cAAf","sourcesContent":["import styles from \"./EditDeletePost.module.css\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Modal } from \"./modal/modal\";\nimport { useAppSelector, useAppDispatch } from \"../../../../redux/hooks\";\nimport X_SVG from \"./x.svg\";\nimport { useMutation, useQuery } from \"@apollo/client\";\nimport currentUserQuery from \"../../../../GQL/queries/CurrentUser\";\nimport editPostMutation from \"../../../../GQL/mutations/editPost\";\nimport deletePostMutation from \"../../../../GQL/mutations/deletePost\";\nimport editUserMutation from \"../../../../GQL/mutations/editUser\";\nimport LoadingSpinner from \"../../../LoadingSpinner/LoadingSpinner\";\n\nconst EditDeletePost = ({ postId, postContent }) => {\n  const [editPost] = useMutation(editPostMutation);\n  const [deletePost] = useMutation(deletePostMutation);\n  const [editUser] = useMutation(editUserMutation);\n  const { refetch } = useQuery(currentUserQuery);\n  const currentUser = useAppSelector((state) => state.currentUser);\n  const [showModal, setShowModal] = useState(false);\n  const [postText, setPostText] = useState(postContent);\n  const [loading, setLoading] = useState(false);\n  useEffect(() => {\n    setPostText(postContent);\n  }, [postContent]);\n\n  const editPostOnClick = () => {\n    setLoading(true);\n    editPost({\n      variables: {\n        id: postId,\n        post: postText,\n      },\n      refetchQueries: [{ query: currentUserQuery }],\n      awaitRefetchQueries: true,\n    })\n      // .then((res) => refetch())\n      .then((res) => [setShowModal(false), setLoading(false)])\n      .catch((err) => {\n        const errors = err.graphQLErrors?.map((error) => error.message);\n        console.log(errors);\n      });\n  };\n  const deletePostOnClick = (e) => {\n    setLoading(true);\n    console.log(\"start\");\n    /* ----------------------------- delete Post ----------------------------- */\n    deletePost({\n      variables: {\n        id: postId,\n      },\n      refetchQueries: [{ query: currentUserQuery }],\n      awaitRefetchQueries: true,\n    })\n      /* -----------------------------Delete post from User--------------------------------------------- */\n      .then((res) =>\n        editUser({\n          variables: {\n            id: currentUser.id,\n            deletePost: postId,\n          },\n          refetchQueries: [{ query: currentUserQuery }],\n          awaitRefetchQueries: true,\n        })\n          .then([setShowModal(false), setLoading(false)])\n          .catch((err) => {\n            const errors = err.graphQLErrors?.map((error) => error.message);\n            console.log(errors);\n          })\n      )\n      .catch((err) => {\n        const errors = err.graphQLErrors?.map((error) => error.message);\n        console.log(errors);\n      });\n  };\n\n  if (!showModal) return <div onClick={() => setShowModal(true)}>...</div>;\n\n  return (\n    <Modal showModal={showModal} setShowModal={setShowModal}>\n      <div\n        className={styles.container}\n        // ref={modal}\n      >\n        <div className={styles.createPostContainer}>\n          <div className={styles.titleContainer}>\n            <h2>Edit Post</h2>\n            <img\n              className={styles.x_svg}\n              src={X_SVG}\n              alt=\"exit\"\n              onClick={() => setShowModal(!showModal)}\n            />\n          </div>\n        </div>\n\n        <div className={styles.contentContainer}>\n          {loading ? (\n            <div className={styles.LoadingSpinner}>\n              <LoadingSpinner />\n            </div>\n          ) : null}\n          <div className={styles.inputContainer}>\n            <textarea\n              className={styles.input}\n              value={postText}\n              onChange={(e) => setPostText(e.target.value)}\n              placeholder={`What's on your mind, ${currentUser.name}?`}\n              // maxlength=\"1\"\n            ></textarea>\n          </div>\n          <div className={styles.postBtnContainer}>\n            <button\n              className={`${styles.editBtn} ${styles.btn}`}\n              onClick={() => editPostOnClick()}\n            >\n              Edit\n            </button>\n            <button\n              className={`${styles.deleteBtn} ${styles.btn}`}\n              onClick={(e) => deletePostOnClick()}\n            >\n              Delete\n            </button>\n          </div>\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default EditDeletePost;\n"]},"metadata":{},"sourceType":"module"}