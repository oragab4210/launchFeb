{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport socketIOClient from \"socket.io-client\";\nimport { sha256, sha224 } from \"js-sha256\";\nimport { useAppSelector, useAppDispatch } from \"../../redux/hooks\";\nimport query from \"../../GQL/queries/getMessages\";\nimport { useQuery, useMutation } from \"@apollo/client\";\nimport useMessages from \"./useMessages\";\nconst NEW_MESSAGE_EVENT = \"newMessage\";\nconst SOCKET_SERVER_URL = \"http://localhost:5000\";\n\nconst useChatRoom = () => {\n  _s();\n\n  const previousMessages = useAppSelector(state => state.previousMessages.value);\n  const {\n    messageList,\n    setMessageList,\n    addMessage\n  } = useMessages();\n  const room = useAppSelector(state => state.currentRoom.value);\n  const [messages, setMessages] = useState([]);\n  const [conversationId, setConversationId] = useState(null);\n  const [hashRoom, setHashRoom] = useState(\"\");\n  const socketRef = useRef();\n  /* -------------------------------------------------------------------------- */\n\n  useEffect(() => {\n    // console.log(\"usechat previous messages\", previousMessages);\n    if (previousMessages) {\n      setMessages(previousMessages);\n    }\n  }, [previousMessages]); // console.log(\"heheh\", messages);\n\n  /* -------------------------------------------------------------------------- */\n  // useEffect(() => {\n  //   if (data) {\n  //     console.log(data.messages[0].message);\n  //     setMessages([...messages, { body: data.messages[0].message }]);\n  //   }\n  // }, [data]);\n\n  /* -------------------------------------------------------------------------- */\n\n  useEffect(() => {\n    setHashRoom(room);\n  }, [room, hashRoom]);\n  /* -------------------------------------------------------------------------- */\n\n  useEffect(() => {\n    socketRef.current = socketIOClient(SOCKET_SERVER_URL);\n\n    if (hashRoom !== undefined) {\n      socketRef.current.emit(\"setRoom\", hashRoom);\n    }\n\n    socketRef.current.on(NEW_MESSAGE_EVENT, message => {\n      const incomingMessage = { ...message,\n        isOwner: message.senderId === socketRef.current.id\n      }; // console.log(incomingMessage);\n      // send the new message to the others in the same room.\n\n      setMessages(messages => [...messages, incomingMessage]);\n    });\n    return () => {\n      socketRef.current.disconnect(hashRoom);\n    };\n  }, [hashRoom]);\n  /* -------------------------------------------------------------------------- */\n\n  const sendMessage = messageBody => {\n    socketRef.current.emit(NEW_MESSAGE_EVENT, {\n      body: messageBody,\n      senderId: socketRef.current.id,\n      room: room\n    });\n    console.log(conversationId);\n    addMessage(room, messageBody);\n  };\n  /* -------------------------------------------------------------------------- */\n\n\n  const combineAddresses = (address1, address2) => {\n    const user1 = [];\n    const user2 = [];\n\n    const makeUnique = (address, userArray) => {\n      for (let i in address) {\n        const letter = address[i]; // console.log(letter, \"index:\" + i);\n\n        userArray.push(letter);\n      }\n    };\n\n    makeUnique(address1, user1);\n    makeUnique(address2, user2);\n    user1.push(...user2);\n    const combinedAddresses = user1; // console.log(user1);\n\n    const sorted = combinedAddresses.sort();\n    const room = sorted.join(\"\");\n    const hash = sha256.create();\n    hash.update(room);\n    const hashedRoom = hash.hex(); // console.log(hashRoom);\n\n    return hashedRoom;\n  };\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n\n\n  return {\n    messages,\n    sendMessage,\n    combineAddresses,\n    conversationId,\n    setConversationId\n  };\n};\n\n_s(useChatRoom, \"3QXuLeAKEev09yTho2vEYcH76w8=\", false, function () {\n  return [useAppSelector, useMessages, useAppSelector];\n});\n\nexport default useChatRoom;","map":{"version":3,"sources":["/Users/omarragab/Documents/Programming/ResumeProject1/client/src/components/CHAT/useChatRoom.js"],"names":["React","useEffect","useRef","useState","useCallback","socketIOClient","sha256","sha224","useAppSelector","useAppDispatch","query","useQuery","useMutation","useMessages","NEW_MESSAGE_EVENT","SOCKET_SERVER_URL","useChatRoom","previousMessages","state","value","messageList","setMessageList","addMessage","room","currentRoom","messages","setMessages","conversationId","setConversationId","hashRoom","setHashRoom","socketRef","current","undefined","emit","on","message","incomingMessage","isOwner","senderId","id","disconnect","sendMessage","messageBody","body","console","log","combineAddresses","address1","address2","user1","user2","makeUnique","address","userArray","i","letter","push","combinedAddresses","sorted","sort","join","hash","create","update","hashedRoom","hex"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport socketIOClient from \"socket.io-client\";\nimport { sha256, sha224 } from \"js-sha256\";\nimport { useAppSelector, useAppDispatch } from \"../../redux/hooks\";\nimport query from \"../../GQL/queries/getMessages\";\nimport { useQuery, useMutation } from \"@apollo/client\";\nimport useMessages from \"./useMessages\";\n\nconst NEW_MESSAGE_EVENT = \"newMessage\";\nconst SOCKET_SERVER_URL = \"http://localhost:5000\";\n\nconst useChatRoom = () => {\n  const previousMessages = useAppSelector(\n    (state) => state.previousMessages.value\n  );\n  const { messageList, setMessageList, addMessage } = useMessages();\n  const room = useAppSelector((state) => state.currentRoom.value);\n\n  const [messages, setMessages] = useState([]);\n  const [conversationId, setConversationId] = useState(null);\n\n  const [hashRoom, setHashRoom] = useState(\"\");\n  const socketRef = useRef();\n  /* -------------------------------------------------------------------------- */\n  useEffect(() => {\n    // console.log(\"usechat previous messages\", previousMessages);\n\n    if (previousMessages) {\n      setMessages(previousMessages);\n    }\n  }, [previousMessages]);\n  // console.log(\"heheh\", messages);\n  /* -------------------------------------------------------------------------- */\n  // useEffect(() => {\n  //   if (data) {\n  //     console.log(data.messages[0].message);\n  //     setMessages([...messages, { body: data.messages[0].message }]);\n  //   }\n  // }, [data]);\n  /* -------------------------------------------------------------------------- */\n  useEffect(() => {\n    setHashRoom(room);\n  }, [room, hashRoom]);\n  /* -------------------------------------------------------------------------- */\n  useEffect(() => {\n    socketRef.current = socketIOClient(SOCKET_SERVER_URL);\n\n    if (hashRoom !== undefined) {\n      socketRef.current.emit(\"setRoom\", hashRoom);\n    }\n\n    socketRef.current.on(NEW_MESSAGE_EVENT, (message) => {\n      const incomingMessage = {\n        ...message,\n        isOwner: message.senderId === socketRef.current.id,\n      };\n\n      // console.log(incomingMessage);\n      // send the new message to the others in the same room.\n      setMessages((messages) => [...messages, incomingMessage]);\n    });\n    return () => {\n      socketRef.current.disconnect(hashRoom);\n    };\n  }, [hashRoom]);\n  /* -------------------------------------------------------------------------- */\n  const sendMessage = (messageBody) => {\n    socketRef.current.emit(NEW_MESSAGE_EVENT, {\n      body: messageBody,\n      senderId: socketRef.current.id,\n      room: room,\n    });\n    console.log(conversationId);\n    addMessage(room, messageBody);\n  };\n  /* -------------------------------------------------------------------------- */\n  const combineAddresses = (address1, address2) => {\n    const user1 = [];\n    const user2 = [];\n    const makeUnique = (address, userArray) => {\n      for (let i in address) {\n        const letter = address[i];\n        // console.log(letter, \"index:\" + i);\n        userArray.push(letter);\n      }\n    };\n    makeUnique(address1, user1);\n    makeUnique(address2, user2);\n    user1.push(...user2);\n    const combinedAddresses = user1;\n    // console.log(user1);\n    const sorted = combinedAddresses.sort();\n    const room = sorted.join(\"\");\n\n    const hash = sha256.create();\n    hash.update(room);\n    const hashedRoom = hash.hex();\n    // console.log(hashRoom);\n\n    return hashedRoom;\n  };\n  /* -------------------------------------------------------------------------- */\n\n  /* -------------------------------------------------------------------------- */\n  return {\n    messages,\n    sendMessage,\n    combineAddresses,\n    conversationId,\n    setConversationId,\n  };\n};\n\nexport default useChatRoom;\n"]},"metadata":{},"sourceType":"module"}